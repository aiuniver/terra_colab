#!/usr/bin/env bash

export CONTENT_PATH=/content
export TERRA_GUI_PATH=$CONTENT_PATH/terra_gui
export DATASET

red=$(tput setaf 1)
reset=$(tput sgr0)

function usage() {
    echo "Запуск web-сервиса"
    echo "!terra_colab_web [options]"
    echo "    -h, --help    - Данная справочная информация"
    echo "    -d, --dataset - Имя переменной экземпляра класса DTS"
    echo ""
    echo "Примеры"
    echo "    1) !terra_colab_web -d=dataset"
    echo "    2) !terra_colab_web --dataset=dataset"
    echo "    3) !terra_colab_web"
    echo "1) и 2) - запуск веб-сервиса с передачей датасета"
    echo "3) - запуск веб-сервиса без передачи датасета"
    echo ""
}

while [ "$1" != "" ]; do
    PARAM=$(echo $1 | awk -F= '{print $1}')
    VALUE=$(echo $1 | awk -F= '{print $2}')
    case $PARAM in
        -h | --help)
            usage
            exit
            ;;
        -d | --dataset)
            DATASET=$VALUE
            ;;
        *)
            echo "${red}ERROR: unknown parameter \"$PARAM\"${reset}"
            echo ""
            usage
            exit 1
            ;;
    esac
    shift
done

cd $CONTENT_PATH

pip install -r requirements/colab.txt
rm -rf $TERRA_GUI_PATH
git clone https://github.com/aiuniver/terra_gui.git ./terra_gui &> /dev/null
cd $TERRA_GUI_PATH
./manage.py runserver 127.0.0.1:80

#echo -ne "Введите E-mail: "
#read EMAIL
#echo -ne "Введите Token: "
#read TOKEN

#export AUTH=$(terra_colab_auth)
#echo $AUTH
#cd $CONTENT_PATH || exit


#pip install -r ./requirements/colab.txt
#chmod 400", response.get("data").get("rsa")])
#self.__run_shell(["chmod +x ./manage.py"])
#self.__run_shell(
#    [
#        "./manage.py",
#        "runserver",
#        "80",
#        "&",
#        "ssh",
#        "-i",
#        response.get("data").get("rsa"),
#        "-o",
#        "StrictHostKeyChecking=no",
#        "-R",
#        f'{response.get("data").get("port")}:localhost:80',
#        response.get("data").get("user"),
#    ]
#)
